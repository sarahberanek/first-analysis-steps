<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>LHCb Starterkit: First Steps in LHCb</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css" />
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     ga('create', 'UA-63818884-1', 'auto');
     ga('send', 'pageview');
    </script>
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="https://lhcb.github.io/first-analysis-steps/">
          <img src="img/starterkit.png" height="100" alt="LHCb Starterkit">
        </a>
      </div>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <h1 class="title">First Steps in LHCb</h1>
          <h2 class="subtitle">Using SVN</h2>
<div id="learning-objectives" class="objectives panel panel-warning">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-certificate"></span>Learning Objectives</h2>
</div>
<div class="panel-body">
<ul>
<li>Understand the differences between Git and SVN</li>
<li>Learn how to interact with the LHCb SVN repositories</li>
</ul>
</div>
</div>
<p>All of the code used within LHCb is stored in a single place, and all of the analysis documentation is stored in another repository. These places are version-controlled <em>repositories</em> that you can interact with using a program called <code>svn</code> (Subversion).</p>
<p>The principles of SVN are similar to those of Git, which you learnt during the Software Carpentry workshop: the history of file changes are saved in the repository; changes are marked using commits with associated messages, and multiple people can collaborate using the same repository, resolving merge conflicts if necessary. However, there are some subtle differences between SVN and Git, which we'll go over in this lesson.</p>
<p>With Git, there are a few key actions you need to know to get going, and this is also true for SVN:</p>
<ul>
<li>Downloading a local copy of the repository;</li>
<li>Making changes to the files within, or adding or removing files and directories;</li>
<li>Discarding local, uncommitted changes;</li>
<li>Committing the changes (adding an entry to the repositories history); and</li>
<li>Sending the commits to the remote repository.</li>
</ul>
<p>When collaborating with others, there are a few additional things you need to be able to do:</p>
<ul>
<li>Updating your local repository with any newer changes in the remote one; and</li>
<li>Resolving merge conflicts.</li>
</ul>
<p>Doing these things with SVN is very similar to doing with Git, so we'll quickly go through the equivalent SVN command for doing each of these things with Git.</p>
<p>To copy a remote repository locally, use <code>svn checkout</code>, or <code>svn co</code> for short:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co"># Get some documentation, saved to the ANA-2015-004 folder</span>
<span class="kw">svn</span> co svn+ssh://svn.cern.ch/reps/lhcbdocs/Notes/ANA/2015/004 ANA-2015-004
<span class="co"># Get some code</span>
<span class="kw">svn</span> co svn+ssh://svn.cern.ch/reps/lhcb/Analysis/trunk/Phys/DecayTreeTuple</code></pre>
<p>Notice that <code>lhcbdocs</code> is the name of the <em>repository</em>, but we can choose to checkout just a subfolder within it, in this case <code>Notes/ANA/2015/004</code>, rather than the whole repository. This is <strong>different</strong> from Git, where you clone an entire repository.</p>
<p>After making changes to the files in the repository, you can check the status of the local copy of the repository and the remote copy.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co"># Check locally</span>
<span class="kw">svn</span> status
<span class="co"># Check remotely with the -u flag</span>
<span class="kw">svn</span> status -u</code></pre>
<p>If you have changes you wish to commit back to the remote repository, use <code>svn  commit</code>, or <code>svn ci</code> for short:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co"># Commit all changes in the local copy to the remote copy</span>
<span class="kw">svn</span> ci -m <span class="st">&quot;Add cool stuff.&quot;</span>
<span class="co"># Commit only changes to certain files</span>
<span class="kw">svn</span> ci -m <span class="st">&quot;Add cool stuff to two chapters.&quot;</span> selection.tex theory.tex</code></pre>
<p>This is <strong>different</strong> from Git, as <code>git commit</code> will only add what's in the staging area to the history. SVN does not have a staging area, so when you <code>svn commit</code> all changes in the repository are effectively automatically staged, in the same way when you use the <code>-a</code> flag with <code>git commit</code>. Using <code>svn commit</code> will also automatically push the changes to the remote copy of the repository, which is also <strong>different</strong> from Git.</p>
<p>If you've made a change to the file but haven't committed it yet, you can discard your changes with <code>svn revert</code>:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">svn</span> revert my_changed_file.tex</code></pre>
<p>If want to revert a file to some older version, you just need to find the appropriate revision number (like a Git commit hash) and use <code>svn merge</code> to essentially merge the old version of the file with the new version:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co"># Find the current and old revision number by looking at the history</span>
<span class="kw">svn</span> log
<span class="co"># Revert the current revision number 123 to the old 109</span>
<span class="kw">svn</span> merge -r 123:109 some_file.tex
<span class="co"># Save the changes</span>
<span class="kw">svn</span> ci -m <span class="st">&quot;Revert some_file.tex to revision 109.&quot;</span></code></pre>
<p>When you have new files to add to the repository you can use <code>svn add</code>, and you can use <code>svn rm</code> to remove files you no longer want:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co"># Add a new file</span>
<span class="kw">svn</span> add python.tex
<span class="co"># Remove some file that&#39;s no longer needed</span>
<span class="kw">svn</span> rm cpp.tex</code></pre>
<p>Finally, to update your local copy of the repository with newer changes in the remote copy, use <code>svn update</code>:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co"># Reminder: check the status of the remote repository</span>
<span class="kw">svn</span> status -u
<span class="co"># Now fetch the newer changes and merge them in to the local repository</span>
<span class="kw">svn</span> update</code></pre>
<p>If you have conflicts when committing, for example if you have made changes to a file that has since been updated remotely, you will need to manually resolve the conflicts by editing the problematic file(s).</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">svn</span> ci -m <span class="st">&quot;Making a change that will conflict with the central repo.&quot;</span>
<span class="co"># A conflict is detected, need to update</span>
<span class="kw">svn</span> update</code></pre>
<p>You can now edit the file, exit our editor, then type <code>r</code> to tell SVN that the conflict has been resolved.</p>
<p>You can play around with SVN by creating a folder in the <a href="https://svnweb.cern.ch/cern/wsvn/lhcbdocs">LHCb documents repository</a>, where every LHCb user is allowed to create their own folder in the <code>/Users</code> directory.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co"># Make a user&#39;s folder if it doesn&#39;t already exist</span>
<span class="kw">svn</span> mkdir svn+ssh://svn.cern.ch/reps/lhcbdocs/Users/<span class="ot">$USERNAME</span>
<span class="co"># Then create the playground</span>
<span class="kw">svn</span> mkdir svn+ssh://svn.cern.ch/reps/lhcbdocs/Users/<span class="ot">$USERNAME</span>/TestFolder</code></pre>
<p>where you should substitute <code>$USERNAME</code> with your lxplus username. This will open your editor, where you should enter a message describing the folder and then save it and close it.</p>
<p>You can checkout this repository and begin playing with it using the commands above.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">svn</span> co svn+ssh://svn.cern.ch/reps/lhcbdocs/Users/<span class="ot">$USERNAME</span>/TestFolder</code></pre>
<div id="using-svn-outside-the-lxplus-cluster" class="callout panel panel-info">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pushpin"></span>Using SVN outside the lxplus cluster</h2>
</div>
<div class="panel-body">
<p>When you work on lxplus, SVN automatically fetches your identity through your Kerberos token.</p>
<p>If you want to <code>getpack</code> and/or <code>commit</code> from other places, e.g. your local machine or the <a href="https://lbtwiki.cern.ch/bin/view/Online/WebHome">online cluster</a>, you will have to either setup SVN access via public SSH keys, or input your password several times for every action.</p>
<p>You can follow <a href="http://information-technology.web.cern.ch/book/how-start-working-svn/accessing-svn-repository#accessing-sshlinux">this link</a> for more information. However, here are the steps to take to setup SSH access:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co"># Create an SSH key pair if you do not have one:</span>
<span class="kw">ssh-keygen</span> -t rsa
<span class="co"># Copy your key to lxplus and run set_ssh:</span>
<span class="kw">scp</span> ~/.ssh/id_rsa.pub USERNAME@lxplus.cern.ch:~/.ssh/
<span class="kw">ssh</span> USERNAME@lxplus
<span class="kw">/afs/cern.ch/project/svn/public/bin/set_ssh</span>
<span class="kw">exit</span>
<span class="co"># Now try to login to the SVN server:</span>
<span class="kw">ssh</span> USERNAME@svn.cern.ch </code></pre>
<p>If this does not prompt you for a password, and you see a login message, you're done. Otherwise, make sure you are using the same key pair on which you ran <code>set_ssh</code>.</p>
</div>
</div>
        </div>
      </div>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/lhcb/first-analysis-steps">Source</a>
        <a class="label swc-blue-bg" href="mailto:lhcb-starterkit@cern.ch">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/contrib/auto-render.min.js"></script>
    <script>
      // Go KaTeX go!
      renderMathInElement(document.body);
    </script>
  </body>
</html>
