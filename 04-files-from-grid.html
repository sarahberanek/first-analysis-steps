<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>LHCb Starterkit: First Steps in LHCb</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css" />
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     ga('create', 'UA-63818884-1', 'auto');
     ga('send', 'pageview');
    </script>
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="https://lhcb.github.io/first-analysis-steps/">
          <img src="img/starterkit.png" height="100" alt="LHCb Starterkit">
        </a>
      </div>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <h1 class="title">First Steps in LHCb</h1>
          <h2 class="subtitle">Downloading a file from the grid</h2>
<div id="learning-objectives" class="objectives panel panel-warning">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-certificate"></span>Learning Objectives</h2>
</div>
<div class="panel-body">
<ul>
<li>Obtain a DST file from the grid</li>
</ul>
</div>
</div>
<p>In the <a href="03-bookkeeping.html">previous section</a>, we obtained a file called <code>MC_2012_27163003_Beam4000GeV2012MagDownNu2.5Pythia8_Sim08e_Digi13_Trig0x409f0045_Reco14a_Stripping20NoPrescalingFlagged_ALLSTREAMS.DST.py</code> which contains the following section:</p>
<pre class="sourceCode python"><code class="sourceCode python">IOHelper(<span class="st">&#39;ROOT&#39;</span>).inputFiles([<span class="st">&#39;LFN:/lhcb/MC/2012/ALLSTREAMS.DST/00035742/0000/00035742_00000001_1.allstreams.dst&#39;</span>,
<span class="st">&#39;LFN:/lhcb/MC/2012/ALLSTREAMS.DST/00035742/0000/00035742_00000002_1.allstreams.dst&#39;</span>,
<span class="co">&#39;LFN:/lhcb/MC/2012/ALLSTREAMS.DST/00035742/0000/00035742_00000003_1.allstreams.dst&#39;</span>,
<span class="co">&#39;LFN:/lhcb/MC/2012/ALLSTREAMS.DST/00035742/0000/00035742_00000004_1.allstreams.dst&#39;</span>,
<span class="co">&#39;LFN:/lhcb/MC/2012/ALLSTREAMS.DST/00035742/0000/00035742_00000005_1.allstreams.dst&#39;</span>,
<span class="co">&#39;LFN:/lhcb/MC/2012/ALLSTREAMS.DST/00035742/0000/00035742_00000006_1.allstreams.dst&#39;</span>,
<span class="co">&#39;LFN:/lhcb/MC/2012/ALLSTREAMS.DST/00035742/0000/00035742_00000007_1.allstreams.dst&#39;</span>,
<span class="co">&#39;LFN:/lhcb/MC/2012/ALLSTREAMS.DST/00035742/0000/00035742_00000008_1.allstreams.dst&#39;</span>,
<span class="co">&#39;LFN:/lhcb/MC/2012/ALLSTREAMS.DST/00035742/0000/00035742_00000009_1.allstreams.dst&#39;</span>,
<span class="co">&#39;LFN:/lhcb/MC/2012/ALLSTREAMS.DST/00035742/0000/00035742_00000010_1.allstreams.dst&#39;</span>
], clear=<span class="ot">True</span>)</code></pre>
<p>which is just a collection of <strong>L</strong>ogical <strong>F</strong>ile <strong>N</strong>ames on the grid.</p>
<p>This is a list of files that make up the dataset we are interested in. Each of the files contains a number of individual events, so if we just want to take a quick look at the dataset, it is sufficient to just obtain one of those files.</p>
<p>Before we can download the file, we need to set up our connection with the grid and load the Dirac software:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">lhcb-proxy-init</span>
<span class="kw">lb-run</span> LHCbDirac <span class="ot">$SHELL</span></code></pre>
<p>Initialisation of the proxy might take a while and should ask you for your certificate password.</p>
<p>Once we have a working Dirac installation, getting the file is as easy as</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">dirac-dms-get-file</span> LFN:/lhcb/MC/2012/ALLSTREAMS.DST/00035742/0000/00035742_00000002_1.allstreams.dst</code></pre>
<p>Again this will take a while but afterwards you should have a file called <code>00035742_00000002_1.allstreams.dst</code> in the directory where you called the command.</p>
<div id="downloading-the-file-during-a-starterkit-lesson" class="callout panel panel-info">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pushpin"></span>Downloading the file during a Starterkit lesson</h2>
</div>
<div class="panel-body">
<p>Lots of people downloading the same file at the same time can be very slow. As a workaround, the file is also available on EOS, and can be downloaded to your current directory with the following command:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">xrdcp</span> root://eoslhcb.cern.ch//eos/lhcb/user/a/apearce/Starterkit/Nov2015/00035742_00000001_1.allstreams.dst .</code></pre>
</div>
</div>
<p>Since these files tend to be quite large, you might want to use your AFS work directory instead of your AFS user directory to store files.</p>
<p>If you want to obtain all the files, you can copy and paste the list of file names from the file you got from the bookkeeping and paste them into the following python script for convenience.</p>
<pre class="sourceCode python"><code class="sourceCode python"><span class="co"># Your list of file names here</span>
FILES = []

<span class="kw">if</span> <span class="ot">__name__</span> == <span class="st">&#39;__main__&#39;</span>:
    <span class="ch">from</span> subprocess <span class="ch">import</span> call
    <span class="ch">from</span> sys <span class="ch">import</span> argv

    n_files = <span class="dt">len</span>(FILES)
    <span class="kw">if</span> <span class="dt">len</span>(argv) &gt; <span class="dv">1</span>:
        n_files = <span class="dt">int</span>(argv[<span class="dv">1</span>])

    files = FILES[:n_files]
    <span class="kw">for</span> f in files:
        <span class="dt">print</span>(<span class="st">&#39;Getting file </span><span class="ot">{0}</span><span class="st">.&#39;</span>.<span class="dt">format</span>(f))
        call(<span class="st">&#39;dirac-dms-get-file </span><span class="ot">{0}</span><span class="st">&#39;</span>.<span class="dt">format</span>(f), shell=<span class="ot">True</span>)
    <span class="dt">print</span>(<span class="st">&#39;Done getting </span><span class="ot">{0}</span><span class="st"> files.&#39;</span>.<span class="dt">format</span>(n_files))</code></pre>
<p>Save it as <code>getEvents.py</code> and use it via <code>python getEvents.py [n]</code>. If you specify <code>n</code>, the script will only get the first n files from the grid.</p>
<div id="such-a-clever-script" class="callout panel panel-info">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pushpin"></span>Such a clever script!</h2>
</div>
<div class="panel-body">
<p>dirac-dms-get-file (and the other dirac-dms-* scripts) is actually able to extract the LFNs from any file and download them for you. So a simple</p>
<pre class="sourceCode python"><code class="sourceCode python"> dirac-dms-get-<span class="dt">file</span> MC_2012_27163003_Beam4000GeV2012MagDownNu2.5Pythia8_Sim08e_Digi13_Trig0x409f0045_Reco14a_Stripping20NoPrescalingFlagged_ALLSTREAMS.DST.py</code></pre>
<p>would do to download them all!</p>
</div>
</div>
        </div>
      </div>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/lhcb/first-analysis-steps">Source</a>
        <a class="label swc-blue-bg" href="mailto:lhcb-starterkit@cern.ch">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/contrib/auto-render.min.js"></script>
    <script>
      // Go KaTeX go!
      renderMathInElement(document.body);
    </script>
  </body>
</html>
